<style type="text/css">
	.chart {
		margin: 50px;
	}
	.chart .rgraph {
		height: 500px;
		margin-bottom: 24px;
	}
	.chart .x_tick .title {
		bottom: -24px;
	}
	.rgraph {
		position: relative;
		left: 40px;
	}
	.y_axis {
		position: absolute;
		top: 0;
		bottom: 0;
		width: 40px;
	}
	.rswatch {
		display: inline-block;
		width: 10px;
		height: 10px;
		margin: 0 8px 0 0;
	}
	.rlabel {
		display: inline-block;
	}
	.rline {
		display: inline-block;
		color: black;
		margin: 0 0 0 30px;
	}
</style>
<ul class="nav nav-tabs">
	<li ng-repeat="t in tabs track by $index" ng-class="{active : $first}"><a showtab href="{{'#query' + $index}}" data-toggle="tab">Query {{$index + 1}}</a></li>
	<li><a href="" ng-click="AddTab()">+</a></li>
</ul>
<div class="row">
	<div class="tab-content">
		<div class="tab-pane fade" ng-class="{active : $first, in : $first}"id="{{'query' + $index}}" ng-repeat="t in tabs track by $index">
			<form role="form">
				<div class="col-lg-4">
					<div class="form-horizontal">
						<div class="form-group">
							<div class="input-group">
								<span class="input-group-addon">Metric</span>
								<input type="text" class="form-control" ng-model="query_p[$index].metric" ng-options="m for m in metrics" placeholder="Metric" ng-change="GetTagKByMetric($index)" ng-init="GetTagKByMetric($index)" limit="30" bs-typeahead>
							</div>
						</div>
						<div class="form-group">
							<div class="input-group" tooltip title="The method used to combine multiple time series into a single time series. This behavior happens when specific or (*) values are omited for tags">
								<span class="input-group-addon">Aggregator</span>
								<select ng-model="query_p[$index].aggregator" ng-options="agg for agg in aggregators" class="form-control"></select>
							</div>
						</div>
						<div class="form-group">
							<div class="input-group" tooltip title="Downsample the data into fewer datapoints. Requires that the downsample window value is also provided.">
								<span class="input-group-addon">Downsample</span>
								<select ng-model="query_p[$index].ds" ng-options="agg for agg in dsaggregators" class="form-control"></select>
							</div>
						</div>
						<div class="form-group">
							<div class="input-group" tooltip title="The time window to downsample to. For example 1h would return a datapoint for every hour by performing the downsample function over that hour. Time Units are ms (Millisecond), s (second), m (minute), h (hour), d (day), w (week), n (month), y (year).">
								<span class="input-group-addon">Downsample Window</span>
								<input type="text" class="form-control" ng-model="query_p[$index].dstime">
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3">
					<div class="form-group">
						<div class="input-group" tooltip title="A positive integer representing the maximum value for the counter.">
							<span class="input-group-addon">Counter Max</span>
							<input type="text" class="form-control" ng-model="query_p[$index].rateOptions.counterMax">
						</div>
					</div>
					<div class="form-group">
						<div class="input-group" tooltip title="An optional value for the rate that, when exceeded, will cause the aggregator to return a 0 instead of the calculated rate. Useful when data sources are frequently reset to avoid spurious spikes.">
							<span class="input-group-addon">Counter Reset</span>
							<input type="text" class="form-control" ng-model="query_p[$index].rateOptions.ResetValue">
						</div>
					</div>
					<div class="form-inline">
						<div class="form-group">
							<div class="checkbox" tooltip title="Whether or not the data should be converted into deltas before returning.">
								<label><input type="checkbox" ng-model="query_p[$index].rate"> Rate</label>
							</div>
						</div>
						<div class="form-group">
							<div class="checkbox" tooltip title="Whether or not the underlying data is a monotonically increasing counter that may roll over">
								<label><input type="checkbox" ng-model="query_p[$index].rateOptions.counter"> Counter</label>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-5">
					<div ng-repeat="(k, v) in query_p[$index].tags">
						<div class="form-group">
							<div class="input-group" tooltip title="Tag values for the tag. Can have multiple seperate by | which will return a time series for each one. Can also be * which returns a time series for each possible value.">
								<span class="input-group-addon">{{k}}</span>
								<input type="text" class="form-control" ng-model="query_p[$parent.$index].tags[k]" ng-options="tv for tv in tagvs[$parent.$index][k]" bs-typeahead>
							</div>
						</div>
					</div>	
				</div>
			</form>
		</div>
	</div>
</div>
<div class="row">
<div class="form-horizontal">
	<div class="col-lg-4">
		<div class="form-group">
			<div class="input-group" tooltip title="Can be absolute or relative time. Relative times follow the format <amount><time unit>-ago. Time Units are ms (Millisecond), s (second), m (minute), h (hour), d (day), w (week), n (month), y (year). Absolute time is in the format yyyy/MM/dd-HH:mm:ss , where any of the time (but not date) parts can be omitted.">
				<span class="input-group-addon">Start</span>
				<input type="text" class="form-control" ng-model="start">
			</div>
		</div>
	</div>
</div>	
	<div class="col-lg-4">
		<div class="form-group">
			<div class="input-group" tooltip title="Current time if blank. Can be absolute or relative time. Relative times follow the format <amount><time unit>-ago. Time Units are ms (Millisecond), s (second), m (minute), h (hour), d (day), w (week), n (month), y (year). Absolute time is in the format yyyy/MM/dd-HH:mm:ss , where any of the time (but not date) parts can be omitted.">
				<span class="input-group-addon">End</span>
				<input type="text" class="form-control" ng-model="end">
			</div>
		</div>
	</div>
	<div class="form-group">
		<button class="btn btn-default" ng-click="Query()" class="form-control">Query</button>
	</div>
</div>
<div class="row" ng-show="error">
	<div class="col-lg-12">
		<div class="alert alert-danger" ng-bind="error"></div>
	</div>
</div>
<div class="row" ng-show="running">
	<div class="col-lg-12">
		<div class="alert alert-info">Executing: {{running}}</div>
	</div>
</div>
<div class="row">
	<div class="chart" ts-rickshaw="result"></div>
</div>

