tsdbHost = ny-devtsdb04.ds.stackexchange.com:4242
smtpHost = ny-mail.ds.stackexchange.com:25
emailFrom = tsaf@stackexchange.com
httpListen = :8070
timeAndDate = 202,75,179,136
stateFile = ../tsaf.state
checkFrequency = 5m

notification default {
	#email = mjibson@stackoverflow.com
	print = true
}

template o {
	subject = hi test {{ .Group.host }} name
}

template generic {
	body = `<a href="{{.Ack}}">Acknowledge alert</a>
	<p>Alert definition:
	<p>Name: {{.Alert.Name}}
	<p>Crit: {{.Alert.Crit}}
	
	<p>Tags
	
	<table>
		{{range $k, $v := .Group}}
			{{if eq $k "host"}}
				<tr><td>{{$k}}</td><td><a href="{{$.HostView $v}}">{{$v}}</a></td></tr>
			{{else}}
				<tr><td>{{$k}}</td><td>{{$v}}</td></tr>
			{{end}}
		{{end}}
	</table>

	<p>Computation
	
	<table>
		{{range .Computations}}
			<tr><td>{{.Text}}</td><td>{{.Value}}</td></tr>
		{{end}}
	</table>`
	subject = {{.Last.Status}}: {{.Alert.Name}}: {{.E .Alert.Vars.q}} on {{.Group.host}} {{template "o" .}}
}

alert os.high.cpu {
	template = generic
	$q = avg(q("avg:rate{counter,,1}:os.cpu{host=*}", "2m", ""))
	warn = $q > 20
	crit = $q >= 10
	critNotification = default
	#back01 incorrectly reports cpu in proc/uptime, maybe old centos bug...
	squelch = host=ny-back01
}
